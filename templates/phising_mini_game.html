<!DOCTYPE html>
<html>
<head>
    <title>Phishing Mini Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        #emailContainer, #answerContainer {
            margin-bottom: 20px;
        }
        button {
            padding: 10px 20px;
            margin-right: 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Phishing Mini Game</h1>
    
    <div id="emailContainer">
        <h2>Check the email below and decide if it's a phishing email or not:</h2>
        <strong>Subject:</strong><p id="emailSubject"></p>
        <strong>Body:</strong><p id="emailBody"></p>
    </div>
    
    <div id="answerContainer">
        <h2>Is this a phishing email?</h2>
        <button onclick="checkAnswer(true)">Yes</button>
        <button onclick="checkAnswer(false)">No</button>
    </div>
    
    <div id="scoreContainer">
        <strong>Score:</strong><span id="score">0</span>
    </div>

    <script>
        let score = 0;
        let emailCount = 0;
        let usedEmails = [];

        async function fetchEmails() {
            const response = await fetch('/emails.json');
            return response.json();
        }

        function updateScore(isCorrect) {
            if (isCorrect) {
                score++;
                alert("Correct!");
            } else {
                alert("Wrong!");
            }
            document.getElementById("score").textContent = score.toString();
            generateEmail();
        }

        async function generateEmail() {
            if (emailCount >= 10) {
                alert("Congrats! You completed the phishing mini game.");
                window.location.href = "/";
                return;
            }

            const { emails } = await fetchEmails();
            let randomIndex = Math.floor(Math.random() * emails.length);

            while (usedEmails.includes(randomIndex)) {
                randomIndex = Math.floor(Math.random() * emails.length);
            }

            usedEmails.push(randomIndex);
            emailCount++;

            const email = emails[randomIndex];
            document.getElementById("emailSubject").textContent = email.subject;
            document.getElementById("emailBody").textContent = email.body;

            document.querySelectorAll("#answerContainer button").forEach(button => {
                button.onclick = () => updateScore(email.isPhishing === (button.textContent === "Yes"));
            });
        }
        
        generateEmail();
    </script>
</body>
</html>
