<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phishing Email Game</title>
<style>
    body, html {
        height: 100%;
        margin: 0;
        font-family: Arial, sans-serif;
    }
    .email-client-container {
        background-image: url('../static/email.png');
        background-size: cover;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }
    .email-content {
        background: rgba(255, 255, 255, 0.8);
        border-radius: 8px;
        padding: 20px;
        margin-top: 50px; /* Adjust as per your layout */
        width: 50%; /* Adjust as per your layout */
    }
    .email-subject, .email-body {
        margin-bottom: 20px;
    }
    .email-subject {
        font-size: 1.2em;
        font-weight: bold;
    }
    .decision-buttons {
        display: flex;
        justify-content: space-around;
    }
    button {
        padding: 10px 20px;
        font-size: 1em;
        margin: 5px;
        cursor: pointer;
    }
    /* Add further styling as needed */
</style>
</head>
<body>

<div class="email-client-container">
    <div class="email-content">
        <div class="email-subject" id="emailSubject">[Subject Placeholder]</div>
        <div class="email-body" id="emailBody">[Body Placeholder]</div>
        <div class="decision-buttons">
            <button onclick="checkAnswer(true)">Yes</button>
            <button onclick="checkAnswer(false)">No</button>
        </div>
    </div>
</div>

    <script>
        let score = 0;
        let emailCount = 0;
        let usedEmails = [];

        async function fetchEmails() {
            const response = await fetch('/emails.json');
            return response.json();
        }

        function updateScore(isCorrect) {
            if (isCorrect) {
                score++;
                alert("Correct!");
            } else {
                alert("Wrong!");
            }
            document.getElementById("score").textContent = score.toString();
            generateEmail();
        }

        async function generateEmail() {
            if (emailCount >= 10) {
                alert("Congrats! You completed the phishing mini game.");
                window.location.href = "/";
                return;
            }

            const { emails } = await fetchEmails();
            let randomIndex = Math.floor(Math.random() * emails.length);

            while (usedEmails.includes(randomIndex)) {
                randomIndex = Math.floor(Math.random() * emails.length);
            }

            usedEmails.push(randomIndex);
            emailCount++;

            const email = emails[randomIndex];
            document.getElementById("emailSubject").textContent = email.subject;
            document.getElementById("emailBody").textContent = email.body;

            document.querySelectorAll("#answerContainer button").forEach(button => {
                button.onclick = () => updateScore(email.isPhishing === (button.textContent === "Yes"));
            });
        }
        
        generateEmail();
    </script>
</body>
</html>
